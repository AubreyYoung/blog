[TOC]

# **操作系统检查**

----

## 1.1 OS性能监控-CPU

### 1.1.1 进程监控

```shell
ps axwwo user,pid,ppid,%cpu,%mem,vsz,rss,size,stat,start_time,time,maj_flt,cls,nice,pri,nlwp,tty,psr,cmd --forest --cols 300

ps axwwo user,pid,ppid,%cpu,%mem,vsz,rss,stat,time,cmd

//报错需修改
ps -ef | grep -v root | grep -v grep | awk '{print $4}' | grep ^[0-9] | awk '{print "taskset -p",$0}' | sh | grep -v "current affinity mask: [fF]\{1,256\}[fF]"
```



```shell
vmstat 1 4
cat /proc/cpuinfo
cat /proc/interrupts
cat  /proc/loadavg
lscpu
```



## 1.2 OS性能监控-Memory

```shell
free -h
free -g
cat /proc/buddyinfo
cat /proc/cgroups
cat /proc/meminfo
cat /usr/bin/numastat
cat /proc/zoneinfo
cat /proc/slabinfo
cat /proc/vmstat
cat  /sys/kernel/mm/transparent_hugepage/defrag
cat /sys/kernel/mm/transparent_hugepage/khugepaged/defrag
cat /sys/kernel/mm/transparent_hugepage/khugepaged/max_ptes_none
cat /sys/kernel/mm/transparent_hugepage/khugepaged/pages_to_scan
cat /sys/kernel/mm/transparent_hugepage/khugepaged/pages_collapsed
cat /sys/kernel/mm/transparent_hugepage/khugepaged/full_scans
cat /sys/kernel/mm/transparent_hugepage/khugepaged/alloc_sleep_millisecs
cat /sys/kernel/mm/transparent_hugepage/khugepaged/scan_sleep_millisecs
numactl --hardware
pmap PID
```



## 1.3 OS性能监控-Disk I/O

```shell
fdisk -l 2>/dev/null | grep Disk
parted -s /dev/sda unit s print
iostat -x 1 4
lsscsi
scsiinfo -l
lsscsi -H
sfdisk -d
lsblk -o 'NAME,KNAME,MAJ:MIN,FSTYPE,LABEL,RO,RM,MODEL,SIZE,OWNER,GROUP,MODE,ALIGNMENT,MIN-IO,OPT-IO,PHY-SEC,LOG-SEC,ROTA,SCHED,MOUNTPOINT'
cat /proc/partitions
cat /etc/fstab
cat /proc/mounts
cat /etc/mtab
cat /proc/cmdline
cat /proc/consoles
cat /proc/diskstats
cat /proc/filesystems
cat /proc/iomem
cat /proc/ioports
cat /proc/locks
cat /proc/mdstat
cat /etc/lvm/lvm.conf
cat /etc/sysconfig/lvm
ls -l /etc/lvm/backup/*
pvdisplay -vv
vgdisplay -vv
lvdisplay -vv
pvs -vvvv
pvscan -vvv
vgs -vvvv
lvs -vvvv
```





## 1.4 OS性能监控-Network

```shell
ip neighbour show
ip route list table all
ip route list table cache
ip rule show
ip maddress show
ip tunnel show
ss -s
ss -nlp
ss -aneimp | head -n 5001
ping -s 1300 -W1 -c3 -i0.1 10.0.0.2
ethtool -g eth0
cat /sys/class/net/eth0/statistics/*
cat /proc/net/stat/arp_cache
cat /proc/net/softnet_stat
tc qdisc show
tc filter show
tc class show
```



```shell
vmstat 1 3
mpstat -P ALL 1 3
```

```shell
cat /proc/sys/kernel/tainted   //内核模块
ps -elf|egrep " D| Z"        //僵尸进程
```



## 1.5 查看OS系统配置

```shell
cat cat /proc/sys/kernel/tainted
cat /etc/grub.conf
cat  /boot/grub/menu.lst
cat /boot/grub/device.map
hwinfo --framebuffer
cat  /etc/sysconfig/kernel
cat /etc/init.d/boot.local
cat /etc/init.d/before.local 
cat /etc/init.d/after.local
cat /etc/init.d/halt.local
cat /proc/devices
cat /proc/crypto
cat /proc/dma
cat /proc/execdomains
cat /proc/fb
cat  /usr/bin/procinfo
ls -l --time-style=long-iso /usr/lib64/efi
ls -lkt /etc/security
ls -lkt /
ls -lkt /var/log/atop/
ls -lkt /var/
ls -lkt /var/lib/
ls -lkt /var/log/audit/audit.log

stat /etc/security
```



## 2.1 操作系统版本/架构

### 2.1.1 查看定时任务

**Linux**

```
crontab -l
crontab -u oracle  -l
crontab -u grid -l

/etc/cron.deny 表示不能使用 crontab 命令的用户
/etc/cron.allow 表示能使用 crontab 的用户。
如果两个文件同时存在，那么/etc/cron.allow 优先。
如果两个文件都不存在，那么只有超级用户可以安排作业。
每个用户都会生成一个自己的 crontab 文件。这些文件在/var/spool/cron 目录下,查看这些文件，里面的内容和对应用户显示的 crontab -l 一致。

ls -lkt /etc/crontab
```
**HP-UX、Solaris、AIX**

```
crontab -l
crontab -l grid
crontab -l oracle
```
### 2.1.2 查看系统负载

```
uptime
w
who
who -b
who -r
whoami
cat /proc/uptime
```
### 2.1.3 查看OS内核信息
**AIX**

```
oslevel -r
oslevel -s
bootinfo
```
**Linux/Solaries/HP-UX**

```
uname -a
uname -r
uname -m
uname -sr                          <!--HP-UX操作系统及版本-->

cat /etc/redhat-release
cat /proc/version         //suse
cat /etc/SuSE-release			//suse
cat /etc/lsb-release

lsb_release			//suse、redhat
lsb_release -a    //suse、Redhat
```
**Windows**

```
winver>win.txt   或者 我的电脑—属性截图
```
### 2.1.4 查看IP地址信息

**Windows**

```
hostname>host.txt
ipconfig>ip.txt
```
**Linux/AIX**

```
cat /etc/hosts
ifconfig -a
ethtool eth1
ip addr    <!--linux-->
netstat -in
netstat -r
```
**HP-UX网卡配置**

```
ioscan -fnC lan
lanscan
vi /etc/rc.config.d/netconf
cat /etc/inetd.conf          <!--已经打开的网络协议-->
netstat -in
/opt/ignite/bin/print_manifest
```
## 2.2 系统内存检查

**Windows**

```
systeminfo>info.txt   或者   “任务管理器—性能”截图 Windows检查虚拟内存设置
```
**Linux**

```
cat /proc/meminfo
grep MemTotal /proc/meminfo
grep SwapTotal /proc/meminfo
free
free -g
free -h                 <!--Redhat6.X以后支持-->
```
**AIX**

```
lsattr -El sys0 -a realmem
lsps -a											//查看交换分区使用
svmon -G
prtconf
lscfg -v
nmon
topas
```
[^注]: 如果不带任何标志运行 prtconf 命令，会显示系统型号、机器序列号、处理器类型、处理器数目、处理器时钟速度、cpu 类型、总内存大小、网络信息、文件系统信息、调页空间信息和设备信息。nmon 然后敲m   巡检报告中务必体现该命令输出信息，可选择截图方式保存

**Solaris**

```
echo ::memstat | mdb -k
/usr/sbin/prtconf |grep "Memory size"
swap -s
prstat -a										//如需要看具体那个进程占用内存的情况可以使用使用
```

**HP-UX**

```
/usr/contrib/bin/machinfo | grep -i memory
dmesg|grep Physical
swapinfo -atm
```
## 2.3 操作系统补丁检查

**AIX**

**11.2 AIX6.1 RAC**

```
lslpp -l abos.adt.base bos.adt.lib bos.adt.libm bos.perf.libperfstat bos.perf.perfstat bos.perf.proctools xlC.aix61.rte xlC.rte rsct.basic.rte rsct.compat.clients.rte gpfs.base
```
**AIX6.1 单机**

```
lslpp -l bos.adt.base bos.adt.lib bos.adt.libm bos.perf.libperfstat bos.perf.perfstat bos.perf.proctools xlC.aix61.rte xlC.rte
```
**Linux**

```shell
/bin/rpm -qa --queryformat "%{DISTRIBUTION}\n" | sort | uniq
```



**11.2 OL7 or RHEL7 (x86-64)**

```
rpm -q compat-libstdc++-33 binutils compat-libcap1 gcc gcc-c++ glibc glibc-devel ksh libaio libaio-devel libgcc libstdc++ libstdc++-devel libXi libXtst make sysstat cpp glibc-headers mpfr
```
[^注 ]: i386和x86_64都要有的包：glibc glibc-devel libaio libaio-devel libgcc libstdc++ libstdc++-devel libXi libXtst
[^参考文章]: Requirements for Installing Oracle 11.2.0.4 RDBMS on OL7 or RHEL7 64-bit (x86-64) (文档 ID 1962100.1)

**11.2 OL6 or RHEL6 (x86-64)**

```
rpm -q binutils compat-libcap1 compat-libstdc++-33 gcc gcc-c++ glibc glibc glibc-devel glibc-devel ksh libgcc libstdc++ libstdc++-devel libaio libaio-devel make sysstat cpp glibc-headers mpfr
```
[^参考文章]: Requirements for Installing Oracle 11gR2 RDBMS on RHEL6 or OL6 64-bit (x86-64) (文档 ID 1441282.1)

**11.2 OL5 or RHEL5 (x86-64)**

```
rpm -q --queryformat "%{NAME}-%{VERSION}-%{RELEASE} (%{ARCH})\n" binutils compat-libstdc++-33 gcc gcc-c++ elfutils-libelf elfutils-libelf-devel elfutils-libelf-devel-static glibc glibc-common glibc-devel glibc-headers ksh libaio libaio-devel libgcc libstdc++ libstdc++-devel make sysstat unixODBC unixODBC-devel
```
[^注 ]: i386和x86_64都要有的包：compat-libstdc++-33 glibc libaio libgcc libstdc++ glibc-devel libaio-devel unixODBC unixODBC-devel

**11.1 OL5 or RHEL5 (x86-64)**

```
rpm -q --queryformat "%{NAME}-%{VERSION}-%{RELEASE} (%{ARCH})\n" binutils compat-libstdc++-33 elfutils-libelf elfutils-libelf-devel gcc gcc-c++ glibc glibc-common glibc-devel libaio libaio-devel libgcc libstdc++ libstdc++-devel make sysstat
```
[^注]: i386和x86_64都要有的包：compat-libstdc++-33 glibc glibc-devel libaio libgcc libstdc++

**10.2 RHEL5**

```
rpm -q --queryformat "%{NAME}-%{VERSION}-%{RELEASE} (%{ARCH})\n" compat-libstdc++-33 gcc-c++ libstdc++-devel glibc-headers glibc-devel glibc-devel libgomp gcc libXp sysstat util-linux
```
[^注]: i386和x86_64都要有的包：compat-libstdc++ glibc-devel   只有i386的包：libXp

**HP-UX查看补丁是否安装命令**

```
swlist –l <补丁名>
swlist –l PHSS_39824

//HP-UX查看系统中安装的所有补丁
/usr/sbin/swlist -l patch | more
swlist –l fileset –a state
swlist -l bundle
swlist -l product
swlist -l product | grep PH
swlist -l fileset -a state -a patch_state
```
## 2.4 操作系统参数设置检查

**AIX内核参数检查**

```
cat /etc/security/limits							//AIX检查用户shell资源限制
ulimit -a
lsattr -EH -l sys0 -a maxuproc						//AIX Maxuproc参数设置
ioo -F -a | grep -i aio								//AIX检查AIX系统aio设置
vmo -a -F											//AIX检查虚拟内存参数
```
**Linux内核参数检查**

```
cat /etc/sysctl.conf
cat /etc/security/limits.conf
sysctl -a
ulimit -a
```
**Solaris**

```
cat /etc/system
```
**HP-UX查看参数设置**

```
cat /stand/system
sysdef
/usr/sbin/kcweb -F
ulimit -a

kctune| grep shm										//**HP-UX共享内存参数**
kcmodule -d												//**HP-UX显示每个module及描述**
kctune -d												//**HP-UX显示每个内核参数及描述**
kcusage -ht filecache_max								//**HP-UX查看HP-UX的filecache使用率**
kctune filecache_min=5% filecache_max=10%				//**HP-UX修改filecache_max**
ls /stand												//**HP-UX系统内核文件**

//**HP-UX检查UDP和TCP内核参数**
/usr/bin/ndd /dev/tcp tcp_smallest_anon_port tcp_largest_anon_port
/usr/bin/ndd /dev/udp udp_smallest_anon_port udp_largest_anon_port
```
## 2.5 操作系统时区、时间检查

**AIX,HP-UX,Solaris**

```
echo $TZ
date
```
**Linux**

```
cat /etc/sysconfig/clock
timedatectl status    										//Linux7.X
date -R
date -u
hwclock
localtime
```
## 2.6 操作系统日志信息
**AIX**

```
errpt -a
errpt
last
```
**Linux**

```
cat /var/log/messages
tail -n 2000 /var/log/messages
dmesg
dmesg | grep -i SCSI
dmesg |grep fail
dmesg |grep error
last -n 100
lastlog
lastb
tail -1000  /var/log/secure
cat /var/log/boot.log   //redhat
cat /var/log/boot.msg    //suse
cat /var/log/boot.omsg		//suse
cat /etc/init.d/after.local
ls /var/log/wtmp
last -xF -f /tmp/last_log/wtmp
```
**Solaris**

```
cat /var/adm/messages
```
**HP-UX**

```
/var/adm/syslog/syslog.log                   //系统常用信息，如配置、修改、启动、关闭等信息
/var/adm/syslog/mail.log                     //电子邮件信息
/var/adm/sulog                               //执行su的情况
/var/adm/btmp                                //所有注册失败信息
cmviewcl –v                                  //检查cluster状况
dmesg
dmesg | grep -i SCSI
dmesg |grep fail
dmesg |grep error
uptime
cat  /var/adm/syslog/syslog.log|grep panic
cat /var/adm/syslog/syslog.log |grep warning
cat /var/adm/syslog/syslog.log |grep err
lastb                                       		//查看失败登录
last
cat /var/adm/syslog/syslog.log|grep error
cat /var/adm/syslog/syslog.log|grep fail
cat /var/adm/syslog/OLDsyslog.log |grep error
cat /var/adm/syslog/OLDsyslog.log |grep fail
/var/adm/syslog/syslog.log							//**系统日志**
/var/adm/syslog/OLDsyslog.log 						//**上一次系统日志**
/etc/rc.log											//**系统启动日志目录**
/etc/shutdownlog									//**系统关机日志目录**
/var/adm/crash										//**系统CORE DUMP目录**
```
**Tru64**

```
/var/adm/messages
```
**Windows**

```
save Application Log and System Log as .TXT files using Event Viewer
```
## 2.7 检查cpu信息
**Windows**

```
wmic cpu list brief>cpu.txt
systeminfo
```
**AIX**

```
pmcycles -m												//**查看逻辑cpu个数**
bindprocessor -q
prtconf|grep Processors									//**查看物理cpu个数**
```
**Linux**

```
cat /proc/cpuinfo
lscpu
```
**HP-UX**

```
machinfo
ioscan -fnC processor
```
**Solaris**

```
mpstat  
psrinfo
prtdiag -v
```
## 2.8 查看硬件信息
**Linux**

```
dmidecode
smartctl --all /dev/sda
```
**HP-UX查看硬件信息**

```
machinfo										//HP-UX 查看系统信息
cstm											//HP-UX 查看系统配置
/opt/ignite/bin/print_manifest
glance
model											//HP-UX 查看主机型号
ioscan -fn										//HP-UX硬件状态
parstatus										//HP-UX CELL状态
因该命令组件需要单独收费安装，部分客户系统下无此命令，可选择性搜集（该命令类似AIX下的nmon）
```
**AIX**

```
**查看网卡信息**
lsdev -Cc adapter|grep ent
**查看HBA卡信息**
lsdev -Cc adapter|grep fcs
netstat -in										////**查看网络**
netstat -r										//**查看路由表**
```

## 2.9 检查文件系统空间

**Linux**

```
df -h
df -hi
df -i
fdisk -l
mount |column -t
cat /etc/mtab |column -t
cat /etc/fstab
```
**AIX**

```
df -g
mount

//AIX 如若文件系统空间使用率过高，可进一步检查vg信息，在有剩余空间的情况下可以在线扩充文件系统大小；在AIX下可以通过getconf命令去得到裸盘的容量大小
getconf DISK_SIZE /dev/rhdisk1
```
**HP-UX**

```
bdf
df -P
ioscan -m dsf										//**HP-UX检查共享磁盘聚合前后对应关系**

diskinfo /dev/disk/disk								//**HP-UX查看磁盘大小**
diskinfo -v
arraydsp -a

cat /etc/lvmtab										//**HP-UX pv信息**
pvdisplay -v pv名称
vgdisplay -v

ioscan -funC disk									//**HP-UX区别本地磁盘以及外挂磁盘**
ioscan -m lun										//**HP-UX查看lun信息**
ioscan -fnC fc										//**查看HBA卡信息**
lvlnboot -v											//**HP-UX 显示启动卷信息**
setboot												//**HP-UX 启动盘设备path 信息**
lsdev												//**HP-UX 内核加载的设备驱动**
```
**Solaris**

```
df -g 
df -h
```
**Windows**

计算机管理-磁盘管理
## 2.10 检查物理卷
**AIX**

```
lspv                                		//检查pvid 部分，如果使用ASM模式一定要确保删除pvid
lspath										//**查看硬盘**
lsdev -Cc disk								//**列出所有磁盘设备**

//AIX检查reserve policy设置情况
lsattr -El hdisk1 | grep reserve
lsattr -El rhdiskpower1 | grep reserve
for i in `lspv |awk '{print $1}'`;do echo $i `lsattr -El $i |grep reserve` ;done;

//AIX检查共享vg下lv状态
lsvg -l datavg
lslv -l loglv00
```
**HP-UX**

```
strings /etc/lvmtab
```
**Linux**

```
pvscan
vgscan
lvscan
pvdisplay
vgdisplay
lvdisplay
```
## 2.11 多路径状态
**Linux 系统下几种多路径状态的查询方法**

```
multipath -ll											//**multipath方式多路径状态检查**
powermt display dev=all									//**EMC存储powerpath**
dlnkmgr view -path										//**日立多路径软件**
upadmin													//**华为存储多路径查询**
UltraPath CLI #1 >show vlun
```
----

## 2.12 VMware检查

```shell
lsmod |grep -E 'vmmemctl|vmw_balloon'
vmware-toolbox-cmd stat balloon
vmware-toolbox-cmd stat swap
/etc/init.d/vmware-tools status
/sbin/chkconfig -l vmware-tools
```

## 2.13 HBA检查

```shell
lspci | grep Fibre
grep adapter-port /proc/scsi/qla2xxx/*
```

## 2.14 BMC查看

```shell
ipmitool lan print
ipmitool chassis status
ipmitool mc selftest
ipmitool chassis restart_cause
ipmitool sel info
ipmitool sensor
ipmitool sel list last 300
ipmitool fru list
```

