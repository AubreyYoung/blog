
# 操作系统检查

# 一、性能监控优化

## 1. 性能优化概述

### 1.1 Linux性能优化方法


![Linux性能优化](%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A3%80%E6%9F%A5.assets/Linux%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96.png)

### 1.2 常用性能指标
![常见性能指标](操作系统检查.assets/常见性能指标.png)
### 1.3 性能指标监控工具
![性能工具](操作系统检查.assets/性能工具.png)
### 1.4 性能基准测试工具
![性能压测工具](操作系统检查.assets/性能压测工具.png)

## 2. OS性能监控-CPU
### 2.1 进程监控工具

```shell
pstree
ps axwwo user,pid,ppid,%cpu,%mem,vsz,rss,size,stat,start_time,time,maj_flt,cls,nice,pri,nlwp,tty,psr,cmd --forest --cols 300
ps axwwo user,pid,ppid,%cpu,%mem,vsz,rss,stat,time,cmd
ps -auxwww
ps axwwo user,pid,ppid,%cpu,%mem,vsz,rss,stat,time,cmd --sort=-%cpu |head
cat /proc/sys/kernel/tainted   ## 内核模块
ps -elf|egrep " D| Z"        ## 僵尸进程
```

### 2.2 CPU性能指标工具

![CPU性能_性能指标](操作系统检查.assets/CPU性能_性能指标.png)
![CPU性能_根据指标找工具](操作系统检查.assets/CPU性能_根据指标找工具.png)
![CPU性能_根据工具查指标](操作系统检查.assets/CPU性能_根据工具查指标.png)
![CPU性能_瓶颈分析步骤](操作系统检查.assets/CPU性能_瓶颈分析步骤.png)

### 2.3 CPU指标工具实例
```shell
vmstat 1 4
cat /proc/cpuinfo
cat /proc/interrupts
cat  /proc/loadavg
lscpu
```
### 2.4 CPU基准测试

## 3. OS性能监控-Memory

### 3.1 Memory性能_内存映射

![Memory性能_内存映射](操作系统检查.assets/Memory性能_内存映射.png)

### 3.2 Memory性能指标工具

![Memory性能_性能指标](操作系统检查.assets/Memory性能_性能指标.png)
![Memory性能_根据指标找工具](操作系统检查.assets/Memory性能_根据指标找工具.png)
![Memory性能_根据工具查指标](操作系统检查.assets/Memory性能_根据工具查指标.png)
![Memory性能_瓶颈分析步骤](操作系统检查.assets/Memory性能_瓶颈分析步骤.png)

### 3.3 Memory指标工具实例
```shell
free -h
free -g
cat /proc/buddyinfo
cat /proc/cgroups
cat /proc/meminfo
cat /usr/bin/numastat
cat /proc/zoneinfo
cat /proc/slabinfo
cat /proc/vmstat
cat  /sys/kernel/mm/transparent_hugepage/defrag
cat /sys/kernel/mm/transparent_hugepage/khugepaged/defrag
cat /sys/kernel/mm/transparent_hugepage/khugepaged/max_ptes_none
cat /sys/kernel/mm/transparent_hugepage/khugepaged/pages_to_scan
cat /sys/kernel/mm/transparent_hugepage/khugepaged/pages_collapsed
cat /sys/kernel/mm/transparent_hugepage/khugepaged/full_scans
cat /sys/kernel/mm/transparent_hugepage/khugepaged/alloc_sleep_millisecs
cat /sys/kernel/mm/transparent_hugepage/khugepaged/scan_sleep_millisecs
numactl --hardware
pmap PID
```
### 3.4 Memory基准测试

## 4. OS性能监控-Disk I/O

### 4.2 I/O原理
![](操作系统检查.assets/IO性能_索引节点和目录项.png)
![](操作系统检查.assets/IO性能_虚拟文件系统.png)
![](操作系统检查.assets/IO性能_IO栈.png)

### 4.2 I/O性能指标工具
![](操作系统检查.assets/IO性能_性能指标.png)
![](操作系统检查.assets/IO性能_根据指标找工具.png)
![](操作系统检查.assets/IO性能_根据工具查指标.png)
![](操作系统检查.assets/IO性能_瓶颈分析步骤.png)
![](操作系统检查.assets/IO性能_IOSTAT指标解读.png)

### 4.3 I/O指标工具实例

```sh
fdisk -l 2>/dev/null | grep Disk
parted -s /dev/sda unit s print
iostat -x 1 4
lsscsi
scsiinfo -l
lsscsi -H
sfdisk -d
lsblk -o 'NAME,KNAME,MAJ:MIN,FSTYPE,LABEL,RO,RM,MODEL,SIZE,OWNER,GROUP,MODE,ALIGNMENT,MIN-IO,OPT-IO,PHY-SEC,LOG-SEC,ROTA,SCHED,MOUNTPOINT'
cat /proc/partitions
cat /etc/fstab
cat /proc/mounts
cat /etc/mtab
cat /proc/cmdline
cat /proc/consoles
cat /proc/diskstats
cat /proc/filesystems
cat /proc/iomem
cat /proc/ioports
cat /proc/locks
cat /proc/mdstat
cat /etc/lvm/lvm.conf
cat /etc/sysconfig/lvm
ls -l /etc/lvm/backup/*
pvdisplay -vv
vgdisplay -vv
lvdisplay -vv
pvs -vvvv
pvscan -vvv
vgs -vvvv
lvs -vvvv
smartctl --all /dev/sdg

sar -b 1 2
```

### 4.4 I/O基准测试

#### 4.4.1 FIO

```sh
# 随机写
fio -rw=randwrite -bs=4k -runtime=60 -iodepth 1 -numjobs=4 -size=10G -filename/data2/test1 -ioengine libaio -direct=1 -group_reporting -name iops_randwrite

# 顺序写
fio -rw=write -bs=1m -runtime=60 -iodepth 1 -numjobs=4 -size=10G -filename/data2/test1 -ioengine libaio -direct=1 -group_reporting -name bw_write

# 随机读
fio -readonly -rw=randread -bs=4k -runtime=60 -iodepth 1 -numjobs=8 -size=10G -filename/data2/test1 -ioengine libaio -direct=1 -group_reporting -name iops_randread

# 顺序读
fio -readonly -rw=read -bs=1m -runtime=60 -iodepth 1 -numjobs=8 -size=10G -filename/data2/test1 -ioengine libaio -direct=1 -group_reporting -name bw_read

# 混合随机读写
fio -rw=randrw -rwmixread=70 -bs=16k -runtime=60 -iodepth 1 -numjobs=8 -size=10G -filename/data2/test1 -ioengine libaio -direct=1 -group_reporting -name iops_randrw

# 配置文件
fio /usr/share/doc/fio-3.7/examples/ssd-test.fio 

# MySQL FIO配置文件
$ cat mysql-test
# QPS: 40000（10 cores)
# Dataset: 200G
# R/W: 8/2
# ThreadPool Num: 64
#  IO ThreadNum: 32
 
[global]
runtime=86400
time_based
group_reporting
directory=/your_dir
ioscheduler=deadline
refill_buffers
 
[mysql-binlog]
filename=test-mysql-bin.log
bsrange=512-1024
ioengine=sync
rw=write
size=24G
sync=1
rw=write
overwrite=1
fsync=100
rate_iops=64
invalidate=1
numjobs=64
 
[innodb-data]
filename=test-innodb.dat
bs=16K
ioengine=psync
rw=randrw
size=200G
direct=1
rwmixread=80
numjobs=32
 
thinktime=600
thinktime_spin=200
thinktime_blocks=2
 
[innodb-trxlog]
filename=test-innodb.log
bsrange=512-2048
ioengine=sync
rw=write
size=2G
fsync=1
overwrite=1
rate_iops=64
invalidate=1
numjobs=64
```

#### 4.4.2 dd



## 5. OS性能监控-Network

### 5.1 Network原理
![Network性能_网络协议栈基本原理](操作系统检查.assets/Network性能_网络协议栈基本原理.png)

![](操作系统检查.assets/Network性能_网络栈.png)


### 5.2 Network性能指标工具

![Network性能_性能指标](操作系统检查.assets/Network性能_性能指标.png)
**Network性能指标**
实际上，我们通常用带宽、吞吐量、延时、PPS（Packet Per Second）等指标衡量网络的性能。

- **带宽**，表示链路的最大传输速率，单位通常为 b/s （比特 / 秒）。

- **吞吐量**，表示单位时间内成功传输的数据量，单位通常为 b/s（比特 / 秒）或者 B/s（字节 / 秒）。吞吐量受带宽限制，而吞吐量 / 带宽，也就是该网络的使用率。

- **延时**，表示从网络请求发出后，一直到收到远端响应，所需要的时间延迟。在不同场景中，这一指标可能会有不同含义。比如，它可以表示，建立连接需要的时间（比如 TCP 握手延时），或一个数据包往返所需的时间（比如 RTT）。

- **PPS**，是 Packet Per Second（包 / 秒）的缩写，表示以网络包为单位的传输速率。PPS 通常用来评估网络的转发能力，比如硬件交换机，通常可以达到线性转发（即 PPS 可以达到或者接近理论最大值）。而基于 Linux 服务器的转发，则容易受网络包大小的影响。

除了这些指标，**网络的可用性**（网络能否正常通信）、**并发连接数**（TCP 连接数量）、**丢包率**（丢包百分比）、**重传率**（重新传输的网络包比例）等也是常用的性能指标。

![Network性能_根据指标找工具](操作系统检查.assets/Network性能_根据指标找工具.png)
![Network性能_根据工具查指标](操作系统检查.assets/Network性能_根据工具查指标.png)
![Network性能_TCP优化](操作系统检查.assets/Network性能_TCP优化.png)
![Network性能_套接字内核参数优化](操作系统检查.assets/Network性能_套接字内核参数优化.png)
### 5.3 Network指标工具实例

#### 5.3.1 网络配置
```shell
## errors 表示发生错误的数据包数，比如校验错误、帧同步错误等；
## dropped 表示丢弃的数据包数，即数据包已经收到了 Ring Buffer，但因为内存不足等原因丢包；
## overruns 表示超限数据包数，即网络 I/O 速度过快，导致 Ring Buffer 中的数据包来不及处理（队列满）而导致的丢包；
## carrier 表示发生 carrirer 错误的数据包数，比如双工模式不匹配、物理电缆出现问题等；
## collisions 表示碰撞数据包数。

# ifconfig ens33
ens33: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet 192.168.45.14  netmask 255.255.255.0  broadcast 192.168.45.255
        inet6 fe80::59cd:82bb:758f:ee96  prefixlen 64  scopeid 0x20<link>
        ether 00:0c:29:34:37:07  txqueuelen 1000  (Ethernet)
        RX packets 503  bytes 58639 (57.2 KiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 922  bytes 191497 (187.0 KiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
# ip -s  addr show dev ens33
2: ens33: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether 00:0c:29:34:37:07 brd ff:ff:ff:ff:ff:ff
    inet 192.168.45.14/24 brd 192.168.45.255 scope global noprefixroute ens33
       valid_lft forever preferred_lft forever
    inet6 fe80::59cd:82bb:758f:ee96/64 scope link noprefixroute 
       valid_lft forever preferred_lft forever
    RX: bytes  packets  errors  dropped overrun mcast   
    68260      588      0       0       0       0       
    TX: bytes  packets  errors  dropped carrier collsns 
    203045     1010     0       0       0       0 

# ip -s  addr show 
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host 
       valid_lft forever preferred_lft forever
    RX: bytes  packets  errors  dropped overrun mcast   
    35992      409      0       0       0       0       
    TX: bytes  packets  errors  dropped carrier collsns 
    35992      409      0       0       0       0       
2: ens33: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether 00:0c:29:34:37:07 brd ff:ff:ff:ff:ff:ff
    inet 192.168.45.14/24 brd 192.168.45.255 scope global noprefixroute ens33
       valid_lft forever preferred_lft forever
    inet6 fe80::59cd:82bb:758f:ee96/64 scope link noprefixroute 
       valid_lft forever preferred_lft forever
    RX: bytes  packets  errors  dropped overrun mcast   
    70834      611      0       0       0       0       
    TX: bytes  packets  errors  dropped carrier collsns 
    205791     1023     0       0       0       0       
3: ens34: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether 00:0c:29:34:37:11 brd ff:ff:ff:ff:ff:ff
    inet 10.0.0.14/24 brd 10.0.0.255 scope global dynamic noprefixroute ens34
       valid_lft 1628sec preferred_lft 1628sec
    inet6 fe80::8639:2b50:cfce:e24c/64 scope link noprefixroute 
       valid_lft forever preferred_lft forever
    RX: bytes  packets  errors  dropped overrun mcast   
    32528425   22650    0       0       0       0       
    TX: bytes  packets  errors  dropped carrier collsns 
    416796     6568     0       0       0       0       
4: virbr0: <NO-CARRIER,BROADCAST,MULTICAST,UP> mtu 1500 qdisc noqueue state DOWN group default qlen 1000
    link/ether 52:54:00:79:94:7c brd ff:ff:ff:ff:ff:ff
    inet 192.168.122.1/24 brd 192.168.122.255 scope global virbr0
       valid_lft forever preferred_lft forever
    RX: bytes  packets  errors  dropped overrun mcast   
    0          0        0       0       0       0       
    TX: bytes  packets  errors  dropped carrier collsns 
    0          0        0       0       0       0       
5: virbr0-nic: <BROADCAST,MULTICAST> mtu 1500 qdisc fq_codel master virbr0 state DOWN group default qlen 1000
    link/ether 52:54:00:79:94:7c brd ff:ff:ff:ff:ff:ff
    RX: bytes  packets  errors  dropped overrun mcast   
    0          0        0       0       0       0       
    TX: bytes  packets  errors  dropped carrier collsns 
    0          0        0       0       0       0 
    
# ip -o addr
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN \    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
1: lo    inet 127.0.0.1/8 scope host lo
1: lo    inet6 ::1/128 scope host \       valid_lft forever preferred_lft forever
2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP qlen 1000\    link/ether 00:0c:29:ae:1a:6d brd ff:ff:ff:ff:ff:ff
2: eth0    inet 192.168.45.3/24 brd 192.168.45.255 scope global eth0
2: eth0    inet6 fe80::20c:29ff:feae:1a6d/64 scope link \       valid_lft forever preferred_lft forever
3: eth1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP qlen 1000\    link/ether 00:0c:29:ae:1a:77 brd ff:ff:ff:ff:ff:ff
3: eth1    inet 10.0.0.16/24 brd 10.0.0.255 scope global eth1
3: eth1    inet6 fe80::20c:29ff:feae:1a77/64 scope link \       valid_lft forever preferred_lft forever
```
#### 5.3.2 协议栈统计信息
```shell
netstat -neopa

## head -n 3 表示只显示前面 3 行
## -l 表示只显示监听套接字
## -n 表示显示数字地址和端口 (而不是名字)
## -p 表示显示进程信息
# netstat -nlp|head -n 10
Active Internet connections (only servers)
Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    
tcp        0      0 192.168.122.1:53        0.0.0.0:*               LISTEN      1942/dnsmasq        
tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      1543/sshd           
tcp        0      0 127.0.0.1:631           0.0.0.0:*               LISTEN      1540/cupsd          
tcp6       0      0 :::22                   :::*                    LISTEN      1543/sshd           
tcp6       0      0 ::1:631                 :::*                    LISTEN      1540/cupsd          
udp        0      0 0.0.0.0:58932           0.0.0.0:*                           1386/avahi-daemon:  
udp        0      0 192.168.122.1:53        0.0.0.0:*                           1942/dnsmasq        
udp        0      0 0.0.0.0:67              0.0.0.0:*                           1942/dnsmasq   

# netstat -lntup|head -n 10
Active Internet connections (only servers)
Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    
tcp        0      0 192.168.122.1:53        0.0.0.0:*               LISTEN      1942/dnsmasq        
tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      1543/sshd           
tcp        0      0 127.0.0.1:631           0.0.0.0:*               LISTEN      1540/cupsd          
tcp6       0      0 :::22                   :::*                    LISTEN      1543/sshd           
tcp6       0      0 ::1:631                 :::*                    LISTEN      1540/cupsd          
udp        0      0 0.0.0.0:58932           0.0.0.0:*                           1386/avahi-daemon:  
udp        0      0 192.168.122.1:53        0.0.0.0:*                           1942/dnsmasq        
udp        0      0 0.0.0.0:67              0.0.0.0:*                           1942/dnsmasq 


# ss -ltnp|head -n 10
State     Recv-Q    Send-Q       Local Address:Port        Peer Address:Port                                                
LISTEN    0         32           192.168.122.1:53               0.0.0.0:*        users:(("dnsmasq",pid=1942,fd=6))                                              
LISTEN    0         128                0.0.0.0:22               0.0.0.0:*        users:(("sshd",pid=1543,fd=5))                                                 
LISTEN    0         5                127.0.0.1:631              0.0.0.0:*        users:(("cupsd",pid=1540,fd=10))                                               
LISTEN    0         128                   [::]:22                  [::]:*        users:(("sshd",pid=1543,fd=7))                                                 
LISTEN    0         5                    [::1]:631                 [::]:*        users:(("cupsd",pid=1540,fd=9))

接收队列（Recv-Q）和发送队列（Send-Q）需要你特别关注，它们通常应该是 0。当你发现它们不是 0 时，说明有网络包的堆积发生。当然还要注意，在不同套接字状态下，它们的含义不同.

当套接字处于连接状态（Established）时，
	Recv-Q表示套接字缓冲还没有被应用程序取走的字节数(即接收队列长度)
	而Send-Q表示还没有被远端主机确认的字节数(即发送队列长度)
当套接字处于监听状态（Listening）时，
	Recv-Q表示syn backlog的当前值.
	而Send-Q表示最大的syn backlog值.而syn backlog是TCP 协议栈中的半连接队列长度，相应的也有一个全连接队列（accept queue），它们都是维护 TCP 状态的重要机制。
	
顾名思义，所谓半连接，就是还没有完成 TCP 三次握手的连接，连接只进行了一半，而服务器收到了客户端的 SYN 包后，就会把这个连接放到半连接队列中，然后再向客户端发送 SYN+ACK 包。
而全连接，则是指服务器收到了客户端的 ACK，完成了 TCP 三次握手，然后就会把这个连接挪到全连接队列中。这些全连接中的套接字，还需要再被 accept() 系统调用取走，这样，服务器就可以开始真正处理客户端的请求了。
```
#### 5.3.3 网络吞吐和PPS

```shell
## 数字 1 表示每隔 1 秒输出一组数据
# sar -n DEV 1
Linux 4.20.13-200.fc29.x86_64 (localhost.localdomain)   07/26/2019      _x86_64_        (2 CPU)

04:22:27 PM     IFACE   rxpck/s   txpck/s    rxkB/s    txkB/s   rxcmp/s   txcmp/s  rxmcst/s   %ifutil
04:22:28 PM        lo      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
04:22:28 PM     ens34      1.00      0.00      0.35      0.00      0.00      0.00      0.00      0.00
04:22:28 PM virbr0-nic      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
04:22:28 PM    virbr0      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
04:22:28 PM     ens33      2.00      1.00      0.42      0.24      0.00      0.00      0.00      0.00

rxpck/s 和 txpck/s 分别是接收和发送的 PPS，单位为包 / 秒。
rxkB/s 和 txkB/s 分别是接收和发送的吞吐量，单位是 KB/ 秒。
rxcmp/s 和 txcmp/s 分别是接收和发送的压缩数据包数，单位是包 / 秒。
%ifutil 是网络接口的使用率，即半双工模式下为 (rxkB/s+txkB/s)/Bandwidth，而全双工模式下为 max(rxkB/s, txkB/s)/Bandwidth。
其中，Bandwidth 可以用 ethtool 来查询，它的单位通常是 Gb/s 或者 Mb/s，不过注意这里小写字母 b ，表示比特而不是字节。我们通常提到的千兆网卡、万兆网卡等，单位也都是比特.
```

#### 5.3.4 连通性和延时

```shell
# -c3 表示发送三次 ICMP 包后停止
# ping -c3 114.114.114.114
PING 114.114.114.114 (114.114.114.114) 56(84) bytes of data.
64 bytes from 114.114.114.114: icmp_seq=1 ttl=128 time=2.89 ms
64 bytes from 114.114.114.114: icmp_seq=2 ttl=128 time=2.99 ms
64 bytes from 114.114.114.114: icmp_seq=3 ttl=128 time=3.13 ms

--- 114.114.114.114 ping statistics ---
3 packets transmitted, 3 received, 0% packet loss, time 5ms
rtt min/avg/max/mdev = 2.888/3.002/3.128/0.108 ms

ping 的输出，可以分为两部分。
第一部分，是每个 ICMP 请求的信息，包括 ICMP 序列号（icmp_seq）、TTL（生存时间，或者跳数）以及往返延时。
第二部分，则是三次 ICMP 请求的汇总。
比如上面的示例显示，发送了 3 个网络包，并且接收到 3 个响应，没有丢包发生，这说明测试主机到 114.114.114.114 是连通的；平均往返延时（RTT）是 244ms，也就是从发送 ICMP 开始，到接收到 114.114.114.114 回复的确认，总共经历 244ms。
```

#### 5.3.5 其他工具

```shell
ip neighbour show
ip route list table all
ip route list table cache
ip rule show
ip maddress show
ip tunnel show
ss -s
ss -nlp
ss -aneimp | head -n 5001
ping -s 1300 -W1 -c3 -i0.1 10.0.0.2
ethtool -g eth0
cat /sys/class/net/eth0/statistics/*
cat /proc/net/stat/arp_cache
cat /proc/net/softnet_stat
tc qdisc show
tc filter show
tc class show
netstat -as
netstat -nlp
netstat -i
netstat -nr
arp -v
ethtool -k eth0
mii-tool -v eth0
vmstat 1 3
mpstat -P ALL 1 3
```

### 5.4 Network基准测试



# 二. 综合类命令

## 1. top

```sh
top
top -U mysql -c -H								## MySQL用户进程线程信息
```

## 2. dstat

```sh
dstat  -c
dstat  -c -f									## CPU使用率
dstat  -c -C 0,1								## 指定CPU
dstat -l										## 平均负载 
dstat -d										## IO
dstat  -d -f
dstat  -d -D sda,sdb
dstat -r										## 总IOPS
dstat -r -f
dstat -r -D sda,sdb
dstat -m										## Memory
dstat -n										## Network
dstat -n -f
dstat -n -N ens32
dstat -i 										## 中断
dstat -i -f
dstat -i -I										## 指定中断请求
dstat -s										## swap
dstat -s -f
dstat -s -S swap1
dstat -g										## swap页交换
dstat -y										## 上下文切换
dstat -c -l -d -r -m -g -s -n -y -p
```

## 3. sar

```sh
ls -lh /dev/blcok									## 查看设备号

sar -b 1 2 											## 磁盘设备I/O和IOPS
sar -d 1 2											## 块设备
sar -d -j ID 1 2									## 持久化设备信息
sar -d 1 2 -p
sar -H 1 2											## 内存大页
sar -I SUM 1 2										## 中断每秒统计
sar -I 0,1 1 1										## 指定中断信号
sar -I ALL 1 1										## 各个中断信号统计
sar -d 1 2											## 内存大页
sar -n DEV 1 1										## 网络
sar -n NFS 1 1										## NFS
sar -P 0,1 1 1										## CPU
sar -P ALL 1 1										
sar -q 1 1											## CPU队列长度和平均负载
sar -R  1 1											## 缓存
sar -r  1 1											## 内存
sar -S  1 1											## swap空间
sar -v  1 1											## inode、文件和内核表
sar -s  1 1											## swap
sar -w  1 1											## 上下文

# sar -d -j PATH 1 1								## 持久化设备槽位号信息
Linux 3.10.0-957.12.1.el7.x86_64 (mapy)         06/23/2020      _x86_64_        (1 CPU)

11:44:19 AM       DEV       tps  rd_sec/s  wr_sec/s  avgrq-sz  avgqu-sz     await     svctm     %util
11:44:20 AM pci-0000:00:10.0-scsi-0:0:0:0      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00

Average:          DEV       tps  rd_sec/s  wr_sec/s  avgrq-sz  avgqu-sz     await     svctm     %util
Average:    pci-0000:00:10.0-scsi-0:0:0:0      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00

# sar -d -j UUID 1 1    							## 持久化设备UUID信息
Linux 3.10.0-957.12.1.el7.x86_64 (mapy)         06/23/2020      _x86_64_        (1 CPU)

11:46:17 AM       DEV       tps  rd_sec/s  wr_sec/s  avgrq-sz  avgqu-sz     await     svctm     %util
11:46:18 AM       sda      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00

Average:          DEV       tps  rd_sec/s  wr_sec/s  avgrq-sz  avgqu-sz     await     svctm     %util
Average:          sda      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
```

## 4. mpstat

```sh
mpstat -I SUM 1 3									## 中断信号统计

# /usr/bin/mpstat -P ALL 1 3
Linux 2.6.32.59-0.9-default (pmauto) 	05/11/20 	_x86_64_

11:35:19     CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest   %idle
11:35:20     all   45.50    0.00   54.45    0.00    0.00    0.00    0.00    0.00    0.04
11:35:20       0   93.07    0.00    5.94    0.00    0.00    0.99    0.00    0.00    0.00
11:35:20       1   26.00    0.00   74.00    0.00    0.00    0.00    0.00    0.00    0.00
```

## 5. vmstat

```sh
# vmstat -t 1 2
procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu----- -----timestamp-----
 r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st                 CST
 2  0      0 580996   2140 312572    0    0    17     4   26   50  0  0 100  0  0 2020-06-23 13:46:40
 0  0      0 580996   2140 312588    0    0     0     0   30   53  0  0 100  0  0 2020-06-23 13:46:41
 
 # vmstat -d 1 2
disk- ------------reads------------ ------------writes----------- -----IO------
       total merged sectors      ms  total merged sectors      ms    cur    sec
sda     5938      8  523072  120084   2511    339  125469   21596      0     53
sda     5938      8  523072  120084   2511    339  125469   21596      0     53

# vmstat -p /dev/sda1 1 2
sda1          reads   read sectors  writes    requested writes
                 534      11998         10       4136
                 534      11998         10       4136
```

## 6. iostat

```sh
# iostat -c 1 2
Linux 3.10.0-957.12.1.el7.x86_64 (mapy)         06/23/2020      _x86_64_        (1 CPU)

avg-cpu:  %user   %nice %system %iowait  %steal   %idle
           0.08    0.00    0.18    0.19    0.00   99.55

avg-cpu:  %user   %nice %system %iowait  %steal   %idle
           0.00    0.00    0.00    0.00    0.00  100.00
           
           
# iostat -d /dev/sda1 1 2 
Linux 3.10.0-957.12.1.el7.x86_64 (mapy)         06/23/2020      _x86_64_        (1 CPU)

Device:            tps    kB_read/s    kB_wrtn/s    kB_read    kB_wrtn
sda1              0.03         0.38         0.13       5999       2068

Device:            tps    kB_read/s    kB_wrtn/s    kB_read    kB_wrtn
sda1              0.00         0.00         0.00          0          0

# iostat -xd /dev/sda1 1 2
Linux 3.10.0-957.12.1.el7.x86_64 (mapy)         06/23/2020      _x86_64_        (1 CPU)

Device:         rrqm/s   wrqm/s     r/s     w/s    rkB/s    wkB/s avgrq-sz avgqu-sz   await r_await w_await  svctm  %util
sda1              0.00     0.00    0.03    0.00     0.38     0.13    29.66     0.00    2.62    2.53    7.10   2.56   0.01

Device:         rrqm/s   wrqm/s     r/s     w/s    rkB/s    wkB/s avgrq-sz avgqu-sz   await r_await w_await  svctm  %util
sda1              0.00     0.00    0.00    0.00     0.00     0.00     0.00     0.00    0.00    0.00    0.00   0.00   0.00

# iostat -xkt /dev/sda1 1 2 
Linux 3.10.0-957.12.1.el7.x86_64 (mapy)         06/23/2020      _x86_64_        (1 CPU)

06/23/2020 01:54:31 PM
avg-cpu:  %user   %nice %system %iowait  %steal   %idle
           0.08    0.00    0.18    0.18    0.00   99.55

Device:         rrqm/s   wrqm/s     r/s     w/s    rkB/s    wkB/s avgrq-sz avgqu-sz   await r_await w_await  svctm  %util
sda1              0.00     0.00    0.03    0.00     0.38     0.13    29.66     0.00    2.62    2.53    7.10   2.56   0.01

06/23/2020 01:54:32 PM
avg-cpu:  %user   %nice %system %iowait  %steal   %idle
           0.00    0.00    0.99    0.00    0.00   99.01

Device:         rrqm/s   wrqm/s     r/s     w/s    rkB/s    wkB/s avgrq-sz avgqu-sz   await r_await w_await  svctm  %util
sda1              0.00     0.00    0.00    0.00     0.00     0.00     0.00     0.00    0.00    0.00    0.00   0.00   0.00
```

## 7. free

```sh
free -ho										## EL 6
# free -h										## EL 7
              total        used        free      shared  buff/cache   available
Mem:           972M         97M        567M        7.5M        307M        707M
Swap:          2.0G          0B        2.0G
# free -wh
              total        used        free      shared     buffers       cache   available
Mem:           972M         97M        567M        7.5M        2.1M        305M        707M
Swap:          2.0G          0B        2.0G
```

## 8. iotop

```sh
iotop -n 3 -d 1 -b -p `pgrep top|tail -1` -q	## top进程IO
```

## 9. iftop

```sh
iftop -t |tee /tmp/iftop.txt					## 输出到文本
```

## 10.  iperf

```sh
iperf -c 10.10.30.164 -i 60 -t 60 -f a -m -P 3
```



# 三、其他重要命令

## 1. ipcs/ipcrm

```sh
ipcs -m     			## 查看系统使用的IPC共享内存资源
ipcs -q 				## 查看系统使用的IPC队列资源
ipcs -s 				## 查看系统使用的IPC信号量资源

ipcrm -M shmkey			## 移除用shmkey创建的共享内存段
ipcrm -m shmid 			## 移除用shmid标识的共享内存段
ipcrm -Q msgkey			## 移除用msqkey创建的消息队列
ipcrm -q msqid			## 移除用msqid标识的消息队列
ipcrm -S semkey		    ## 移除用semkey创建的信号
ipcrm -s semid 			## 移除用semid标识的信号

## 清除当前用户创建的所有的IPC资源:
ipcs -q | awk '{ print "ipcrm -q "$2}' | sh > /dev/null 2>&1;
ipcs -m | awk '{ print "ipcrm -m "$2}' | sh > /dev/null 2>&1;
ipcs -s | awk '{ print "ipcrm -s "$2}' | sh > /dev/null 2>&1;
```

## 2.  lsof

```sh
lsof -bM -n -l
lsof -p PID											## 查看某一个进程的文件打开数量
lsof -a -p $$ -d0,1,2								## 其中的 -p 选项指定了当前进程的 PID，而 -d 选项则用来指定进程打开的文件描述符(可以通过逗号分隔多个文件描述符)。添加 -a 选项后，结果输出为当前进程打开的文件描述符为 0、1、2 的文件。
lsof -u UID											## 查看某一个用户的文件打开数量
lsof /bin/bash										## 查看哪些进程打开了某个文件
lsof /dev/sda1
lsof +d /var/log									## 查看哪些进程打开了某个目录及目录下的文件
lsof +D /var/log									## 对指定的目录进行递归
lsof -c cr											## 查看指定名称的程序打开的文件,查找以字母 cr 开头的程序打开的文件列表
lsof -c ^cr											## 如果想对-c选项的条件取反，只要在字符串前添加符号^
lsof -c /cr[ao]/ 									## 正则表达式，过滤出以cra和cro开头的程序打开的文件
lsof -i 4											## 只列出IPv4或IPv6打开的文件
lsof -i 6
lsof -i :22											## 列出与 22 号端口相关的文件
lsof -i TCP:1-1024									## 列出指定范围内被打开的 TCP 端口
lsof -a -c sshd -U									## 查看ssh服务打开的UNIX domain socket文件
lsof -a -i -u nick									## 查看用户 nick 打开的网络相关的文件
lsof -i -u ^nick									## 排除某个用户
kill -9 $(lsof -t -u nick)							## 杀掉某个用户打开了文件的所有进程
lsof -P -n | wc -l									## 统计系统打开的文件总数
lsof -c mysql -c apache								## 列出多个进程多个打开的文件信息
lsof -i udp:55										## 列出谁在使用某个特定的udp端口
lsof -i tcp:80										## 特定的tcp端口
lsof -N												## 列出所有网络文件系统
lsof -a -u test -i									## 列出某个用户的所有活跃的网络端口
lsof -d description(like 2)							## 根据文件描述列出对应的文件信息
lsof -d  txt
lsof -d  1
lsof -d  2
lsof -d 2-3											## 根据文件描述范围列出文件信息
lsof -c sshd -a -d txt								## 列出COMMAND列中包含"sshd"文件描符的类型为txt的文件信息
lsof -i 4 -a -p 1234								## 列出被进程号为1234的进程所打开的所有IPV4 network files 
lsof -i @peida.linux:20,21,22,25,53,80  -r  3		## 列出目前连接主机peida.linux上端口为：20，21，22，25，53，80相关的所有文件信息，且每隔3秒不断的执行lsof指令
```

## 3. 句柄

```sh
more /proc/sys/fs/file-max							## 查看系统打开句柄最大数量
lsof|awk '{print $2}'|wc -l							## 查看打开句柄总数
lsof|awk '{print $2}'|sort|uniq -c|sort -nr|more	## 根据打开文件句柄的数量降序排列，其中第二列为进程ID
ulimit -a
```

## 4. CRON

```
cat /var/spool/cron/tabs/acrosspm    ## 查看定时任务
```



# 四、跟踪与探针

## 1. /sys

## 2. /proc

## 3. Trace

## 4.  debug

```sh
sh -x  script.sh
ssh -v 192.168.100.10	或	ssh -vvv 192.168.100.10
```



# 五、信息收集

## 1. 操作系统版本/架构

### 1.1  查看定时任务

**Linux**

```
crontab -l
crontab -u oracle  -l
crontab -u grid -l
crontab -u acrosspm -l

/etc/cron.deny 表示不能使用 crontab 命令的用户
/etc/cron.allow 表示能使用 crontab 的用户。
如果两个文件同时存在，那么/etc/cron.allow 优先。
如果两个文件都不存在，那么只有超级用户可以安排作业。
每个用户都会生成一个自己的 crontab 文件。这些文件在/var/spool/cron 目录下,查看这些文件，里面的内容和对应用户显示的 crontab -l 一致。

ls -lkt /etc/crontab
```
**HP-UX、Solaris、AIX**

```
crontab -l
crontab -l grid
crontab -l oracle
```
### 1.2  查看系统负载

```
uptime
w
who
who -b
who -r
whoami
cat /proc/uptime
```
### 1.3 查看OS内核信息
**AIX**

```
oslevel -r
oslevel -s
bootinfo
```
**Linux/Solaries/HP-UX**

```
uname -a
uname -r
uname -m
uname -sr                          <!--HP-UX操作系统及版本-->

cat /etc/redhat-release
cat /proc/version         ## suse
cat /etc/SuSE-release			## suse
cat /etc/lsb-release

lsb_release			## suse、redhat
lsb_release -a    ## suse、Redhat
```
**Windows**

```
winver>win.txt   或者 我的电脑—属性截图
```
### 1.4  查看IP地址信息

**Windows**

```
hostname>host.txt
ipconfig>ip.txt
```
**Linux/AIX**

```
cat /etc/hosts
ifconfig -a
ethtool eth1
ip addr    <!--linux-->
netstat -in
netstat -r
```
**HP-UX网卡配置**

```
ioscan -fnC lan
lanscan
vi /etc/rc.config.d/netconf
cat /etc/inetd.conf          <!--已经打开的网络协议-->
netstat -in
/opt/ignite/bin/print_manifest
```
## 2.  系统内存检查

**Windows**

```
systeminfo>info.txt   或者   “任务管理器—性能”截图 Windows检查虚拟内存设置
```
**Linux**

```shell
cat /proc/meminfo
grep MemTotal /proc/meminfo
grep SwapTotal /proc/meminfo
free
free -g
free -h                 <!--Redhat6.X以后支持-->
```
**AIX**

```
lsattr -El sys0 -a realmem
lsps -a											## 查看交换分区使用
svmon -G
prtconf
lscfg -v
nmon
topas
```
[^注]: 如果不带任何标志运行 prtconf 命令，会显示系统型号、机器序列号、处理器类型、处理器数目、处理器时钟速度、cpu 类型、总内存大小、网络信息、文件系统信息、调页空间信息和设备信息。nmon 然后敲m   巡检报告中务必体现该命令输出信息，可选择截图方式保存

**Solaris**

```
echo ::memstat | mdb -k
/usr/sbin/prtconf |grep "Memory size"
swap -s
prstat -a										## 如需要看具体那个进程占用内存的情况可以使用使用
```

**HP-UX**

```
/usr/contrib/bin/machinfo | grep -i memory
dmesg|grep Physical
swapinfo -atm
```
## 3.  操作系统补丁检查

**AIX**

**11.2 AIX6.1 RAC**

```
lslpp -l abos.adt.base bos.adt.lib bos.adt.libm bos.perf.libperfstat bos.perf.perfstat bos.perf.proctools xlC.aix61.rte xlC.rte rsct.basic.rte rsct.compat.clients.rte gpfs.base
```
**AIX6.1 单机**

```
lslpp -l bos.adt.base bos.adt.lib bos.adt.libm bos.perf.libperfstat bos.perf.perfstat bos.perf.proctools xlC.aix61.rte xlC.rte
```
**SuSE Linux**

```shell
/bin/rpm -qa --queryformat "%{DISTRIBUTION}\n" | sort | uniq

rpm -V SuSEfirewall2-3.6_SVNr208-2.1
```



**11.2 OL7 or RHEL7 (x86-64)**

```
rpm -q compat-libstdc++-33 binutils compat-libcap1 gcc gcc-c++ glibc glibc-devel ksh libaio libaio-devel libgcc libstdc++ libstdc++-devel libXi libXtst make sysstat cpp glibc-headers mpfr
```
[^注 ]: i386和x86_64都要有的包：glibc glibc-devel libaio libaio-devel libgcc libstdc++ libstdc++-devel libXi libXtst
[^参考文章]: Requirements for Installing Oracle 11.2.0.4 RDBMS on OL7 or RHEL7 64-bit (x86-64) (文档 ID 1962100.1)

**11.2 OL6 or RHEL6 (x86-64)**

```
rpm -q binutils compat-libcap1 compat-libstdc++-33 gcc gcc-c++ glibc glibc glibc-devel glibc-devel ksh libgcc libstdc++ libstdc++-devel libaio libaio-devel make sysstat cpp glibc-headers mpfr
```
[^参考文章]: Requirements for Installing Oracle 11gR2 RDBMS on RHEL6 or OL6 64-bit (x86-64) (文档 ID 1441282.1)

**11.2 OL5 or RHEL5 (x86-64)**

```
rpm -q --queryformat "%{NAME}-%{VERSION}-%{RELEASE} (%{ARCH})\n" binutils compat-libstdc++-33 gcc gcc-c++ elfutils-libelf elfutils-libelf-devel elfutils-libelf-devel-static glibc glibc-common glibc-devel glibc-headers ksh libaio libaio-devel libgcc libstdc++ libstdc++-devel make sysstat unixODBC unixODBC-devel
```
[^注 ]: i386和x86_64都要有的包：compat-libstdc++-33 glibc libaio libgcc libstdc++ glibc-devel libaio-devel unixODBC unixODBC-devel

**11.1 OL5 or RHEL5 (x86-64)**

```
rpm -q --queryformat "%{NAME}-%{VERSION}-%{RELEASE} (%{ARCH})\n" binutils compat-libstdc++-33 elfutils-libelf elfutils-libelf-devel gcc gcc-c++ glibc glibc-common glibc-devel libaio libaio-devel libgcc libstdc++ libstdc++-devel make sysstat
```
[^注]: i386和x86_64都要有的包：compat-libstdc++-33 glibc glibc-devel libaio libgcc libstdc++

**10.2 RHEL5**

```
rpm -q --queryformat "%{NAME}-%{VERSION}-%{RELEASE} (%{ARCH})\n" compat-libstdc++-33 gcc-c++ libstdc++-devel glibc-headers glibc-devel glibc-devel libgomp gcc libXp sysstat util-linux
```
[^注]: i386和x86_64都要有的包：compat-libstdc++ glibc-devel   只有i386的包：libXp

**HP-UX查看补丁是否安装命令**

```
swlist –l <补丁名>
swlist –l PHSS_39824

## HP-UX查看系统中安装的所有补丁
/usr/sbin/swlist -l patch | more
swlist –l fileset –a state
swlist -l bundle
swlist -l product
swlist -l product | grep PH
swlist -l fileset -a state -a patch_state
```
## 4.  操作系统参数设置检查

**AIX内核参数检查**

```
cat /etc/security/limits							## AIX检查用户shell资源限制
ulimit -a
lsattr -EH -l sys0 -a maxuproc						## AIX Maxuproc参数设置
ioo -F -a | grep -i aio								## AIX检查AIX系统aio设置
vmo -a -F											## AIX检查虚拟内存参数
```
**Linux内核参数检查**

```
cat /etc/sysctl.conf
cat /etc/security/limits.conf
sysctl -a
ulimit -a
```
```shell
# Oracle 内核参数建议
# sysctl -a|grep vfs_cache_pressure  越低越倾向于使用file_cache
vm.vfs_cache_pressure = 100
建议值:
vm.vfs_cache_pressure = 200
# sysctl -a|grep min_free_kbytes  物理内存少于该值,强制释放
vm.min_free_kbytes = 67584
建议值: 几百M
# sysctl -a|grep swappiness   缺省60,越高SWAP使用率越高
vm.swappiness = 60
建议值: 
vm.swappiness = 0
```

Solaris

```
cat /etc/system
```
**HP-UX查看参数设置**

```
cat /stand/system
sysdef
/usr/sbin/kcweb -F
ulimit -a

kctune| grep shm										## **HP-UX共享内存参数**
kcmodule -d												## **HP-UX显示每个module及描述**
kctune -d												## **HP-UX显示每个内核参数及描述**
kcusage -ht filecache_max								## **HP-UX查看HP-UX的filecache使用率**
kctune filecache_min=5% filecache_max=10%				## **HP-UX修改filecache_max**
ls /stand												## **HP-UX系统内核文件**

## **HP-UX检查UDP和TCP内核参数**
/usr/bin/ndd /dev/tcp tcp_smallest_anon_port tcp_largest_anon_port
/usr/bin/ndd /dev/udp udp_smallest_anon_port udp_largest_anon_port
```
## 5.  操作系统时区、时间检查

**AIX,HP-UX,Solaris**

```
echo $TZ
date

## AIX查看时区
grep TZ /etc/environment

## HP-UX查看时区
cat /etc/default/tz
## HP-UX设置时区
set_parms timezone
## HP-UX查看可用时区
ls -l /usr/lib/tztab
```
**Linux**

```
cat /etc/sysconfig/clock
timedatectl status    										## Linux7.X
date -R
date -u
hwclock
localtime

## 可用时区
 ls -l /usr/share/zoneinfo
```
## 6.  操作系统日志信息
**AIX**

```
errpt -a
errpt
last
```
**Linux**

```
cat /var/log/messages
tail -n 2000 /var/log/messages
dmesg     或 	cat /proc/kmsg
dmesg | grep -i SCSI
dmesg |grep fail
dmesg |grep error
last -n 100
lastlog
lastb
tail -1000  /var/log/secure
cat /var/log/boot.log   ## redhat
cat /var/log/boot.msg    ## suse
cat /var/log/boot.omsg		## suse
cat /etc/init.d/after.local
ls /var/log/wtmp
last -xF -f /tmp/last_log/wtmp
```
**Solaris**

```
cat /var/adm/messages
```
**HP-UX**

```
/var/adm/syslog/syslog.log                   ## 系统常用信息，如配置、修改、启动、关闭等信息
/var/adm/syslog/mail.log                     ## 电子邮件信息
/var/adm/sulog                               ## 执行su的情况
/var/adm/btmp                                ## 所有注册失败信息
cmviewcl –v                                  ## 检查cluster状况
dmesg
dmesg | grep -i SCSI
dmesg |grep fail
dmesg |grep error
uptime
cat  /var/adm/syslog/syslog.log|grep panic
cat /var/adm/syslog/syslog.log |grep warning
cat /var/adm/syslog/syslog.log |grep err
lastb                                       		## 查看失败登录
last
cat /var/adm/syslog/syslog.log|grep error
cat /var/adm/syslog/syslog.log|grep fail
cat /var/adm/syslog/OLDsyslog.log |grep error
cat /var/adm/syslog/OLDsyslog.log |grep fail
/var/adm/syslog/syslog.log							## **系统日志**
/var/adm/syslog/OLDsyslog.log 						## **上一次系统日志**
/etc/rc.log											## **系统启动日志目录**
/etc/shutdownlog									## **系统关机日志目录**
/var/adm/crash										## **系统CORE DUMP目录**
```
**Tru64**

```
/var/adm/messages
```
**Windows**

```
save Application Log and System Log as .TXT files using Event Viewer
```
## 7.  检查cpu信息
**Windows**

```
wmic cpu list brief>cpu.txt
systeminfo
```
**AIX**

```
pmcycles -m												## **查看逻辑cpu个数**
bindprocessor -q
prtconf|grep Processors									## **查看物理cpu个数**
```
**Linux**

```
cat /proc/cpuinfo
lscpu
```
**HP-UX**

```
machinfo
ioscan -fnC processor
```
**Solaris**

```
mpstat  
psrinfo
prtdiag -v
```
## 8.  查看硬件信息
**Linux**

```
dmidecode
dmidecode  -t baseboard                         ## 主板
dmidecode  -s processor-version					## CPU
dmidecode  -t processor							## CPU
dmidecode  -t memory							## memory
dmidecode  -t 10								## 板载设备

smartctl -a /dev/sda

lshw -short
lshw -class memory
lshw -html >  hardware.html

lsscsi -d

/opt/MegaRAID/MegaCli/MegaCli64 -AdpAllInfo -aALL						## MegaRAID阵列卡型号
/opt/MegaRAID/MegaCli/MegaCli64 -PDList -aALL							## 磁盘信息

lspci -vvv

ethtool ens32
ethtool -i ens32							   ##网卡驱动信息		

ibstat										   ## infiniband设备信息

lspci | grep Fibre							   ## HBA
grep adapter-port /proc/scsi/qla2xxx/*
```
**HP-UX查看硬件信息**

```
machinfo										## HP-UX 查看系统信息
cstm											## HP-UX 查看系统配置
/opt/ignite/bin/print_manifest
glance
model											## HP-UX 查看主机型号
ioscan -fn										## HP-UX硬件状态
parstatus										## HP-UX CELL状态
因该命令组件需要单独收费安装，部分客户系统下无此命令，可选择性搜集（该命令类似AIX下的nmon）
```
**AIX**

```
**查看网卡信息**
lsdev -Cc adapter|grep ent
**查看HBA卡信息**
lsdev -Cc adapter|grep fcs
netstat -in										## **查看网络**
netstat -r										## **查看路由表**
```

## 9.  检查文件系统空间

**Linux**

```
df -h
df -hi
df -i
df -al
fdisk -l
mount |column -t
cat /etc/mtab |column -t
cat /etc/fstab
lsblk
```
**AIX**

```
df -g
mount

## AIX 如若文件系统空间使用率过高，可进一步检查vg信息，在有剩余空间的情况下可以在线扩充文件系统大小；在AIX下可以通过getconf命令去得到裸盘的容量大小
getconf DISK_SIZE /dev/rhdisk1
```
**HP-UX**

```
bdf
df -P
ioscan -m dsf										## **HP-UX检查共享磁盘聚合前后对应关系**

diskinfo /dev/disk/disk								## **HP-UX查看磁盘大小**
diskinfo -v
arraydsp -a

cat /etc/lvmtab										## **HP-UX pv信息**
pvdisplay -v pv名称
vgdisplay -v

ioscan -funC disk									## **HP-UX区别本地磁盘以及外挂磁盘**
ioscan -m lun										## **HP-UX查看lun信息**
ioscan -fnC fc										## **查看HBA卡信息**
lvlnboot -v											## **HP-UX 显示启动卷信息**
setboot												## **HP-UX 启动盘设备path 信息**
lsdev												## **HP-UX 内核加载的设备驱动**
```
**Solaris**

```
df -g 
df -h
```
**Windows**

计算机管理-磁盘管理
## 10. 检查物理卷

**AIX**

```
lspv                                		## 检查pvid 部分，如果使用ASM模式一定要确保删除pvid
lspath										## **查看硬盘**
lsdev -Cc disk								## **列出所有磁盘设备**

## AIX检查reserve policy设置情况
lsattr -El hdisk1 | grep reserve
lsattr -El rhdiskpower1 | grep reserve
for i in `lspv |awk '{print $1}'`;do echo $i `lsattr -El $i |grep reserve` ;done;

## AIX检查共享vg下lv状态
lsvg -l datavg
lslv -l loglv00
```
**HP-UX**

```
strings /etc/lvmtab
```
**Linux**

```
pvscan
vgscan
lvscan
pvdisplay
vgdisplay -vv
lvdisplay
```
## 11. 多路径状态
**Linux 系统下几种多路径状态的查询方法**

```
multipath -ll											## multipath方式多路径状态检查
powermt display dev=all									## EMC存储powerpath
dlnkmgr view -path										## 日立多路径软件
upadmin	show vlun										## 华为存储多路径查询
upResscan/hot_add										## 华为存储扫描
```
## 12. VMware检查

```shell
lsmod |grep -E 'vmmemctl|vmw_balloon'
vmware-toolbox-cmd stat balloon
vmware-toolbox-cmd stat swap
/etc/init.d/vmware-tools status
/sbin/chkconfig -l vmware-tools
```

## 13. BMC查看

```shell
ipmitool lan print
ipmitool chassis status
ipmitool mc selftest
ipmitool chassis restart_cause
ipmitool sel info
ipmitool sensor
ipmitool sel list last 300
ipmitool fru list
```
## 14. 系统服务相关

```shell
systemctl list-unit-files|grep enabled   //7.x
chkconfig --list|grep on
```

## 15. 其他OS配置

```shell
cat /proc/sys/kernel/tainted
cat /etc/grub.conf
cat  /boot/grub/menu.lst
cat /boot/grub/device.map
hwinfo --framebuffer
cat  /etc/sysconfig/kernel
cat /etc/init.d/boot.local
cat /etc/init.d/before.local 
cat /etc/init.d/after.local
cat /etc/init.d/halt.local
cat /proc/devices
cat /proc/crypto
cat /proc/dma
cat /proc/execdomains
cat /proc/fb
cat  /usr/bin/procinfo
ls -l --time-style=long-iso /usr/lib64/efi
ls -lkt /etc/security
ls -lkt /
ls -lkt /var/log/atop/
ls -lkt /var/
ls -lkt /var/lib/
ls -lkt /var/log/audit/audit.log

stat /etc/security

cat /proc/cmdline
cat /etc/sysconfig/ulimit
# 模块
lsmod

# 查看Java安装版本
alternatives --display java
```

# 六、网络命令

## 1.  ping

|        参数         | 详解                                                         |
| :-----------------: | :----------------------------------------------------------- |
|         -a          | Audible ping.                                                |
|         -A          | 自适应ping，根据ping包往返时间确定ping的速度；               |
|         -b          | 允许ping一个广播地址；                                       |
|         -B          | 不允许ping改变包头的源地址；                                 |
|    **-c count**     | ping指定次数后停止ping；                                     |
|         -d          | 使用Socket的SO_DEBUG功能；                                   |
|    -F flow_label    | 为ping回显请求分配一个20位的“flow label”，如果未设置，内核会为ping随机分配； |
|       **-f**        | 极限检测，快速连续ping一台主机，ping的速度达到100次每秒；    |
|     -i interval     | 设定间隔几秒发送一个ping包，默认一秒ping一次；               |
|    -I interface     | 指定网卡接口、或指定的本机地址送出数据包；                   |
|     -l preload      | 设置在送出要求信息之前，先行发出的数据包；                   |
|         -L          | 抑制组播报文回送，只适用于[ping](http://aiezu.com/article/linux_ping_command.html)的目标为一个组播地址 |
|         -n          | 不要将ip地址转换成主机名；                                   |
|     -p pattern      | 指定填充ping数据包的十六进制内容，在诊断与数据有关的网络错误时这个选项就非常有用，如：“-p ff”； |
|         -q          | 不显示任何传送封包的信息，只显示最后的结果                   |
|       -Q tos        | 设置Qos(Quality of Service)，它是ICMP数据报相关位；可以是十进制或十六进制数，详见rfc1349和rfc2474文档； |
|         -R          | 记录ping的路由过程(IPv4 only)； 注意：由于IP头的限制，最多只能记录9个路由，其他会被忽略； |
|         -r          | 忽略正常的路由表，直接将数据包送到远端主机上，通常是查看本机的网络接口是否有问题；如果主机不直接连接的网络上，则返回一个错误。 |
|      -S sndbuf      | Set socket sndbuf. If not specified, it is selected to buffer not more than one packet. |
|    -s packetsize    | 指定每次ping发送的数据字节数，默认为“56字节”+“28字节”的ICMP头，一共是84字节； 包头+内容不能大于65535，所以最大值为65507（linux:65507, windows:65500）； |
|       -t ttl        | 设置TTL(Time To Live)为指定的值。该字段指定IP包被路由器丢弃之前允许通过的最大网段数； |
| -T timestamp_option | 设置IP timestamp选项,可以是下面的任何一个： 　　'tsonly' (only timestamps) 　　'tsandaddr' (timestamps and addresses) 　　'tsprespec host1 [host2 [host3]]' (timestamp prespecified hops). |
|       -M hint       | 设置MTU（最大传输单元）分片策略。 可设置为： 　　'do'：禁止分片，即使包被丢弃； 　　'want'：当包过大时分片； 　　'dont'：不设置分片标志（DF flag）； |
|       -m mark       | 设置mark；                                                   |
|         -v          | 使ping处于verbose方式，它要ping命令除了打印ECHO-RESPONSE数据包之外，还打印其它所有返回的ICMP数据包； |
|         -U          | Print full user-to-user latency (the old behaviour). Normally ping prints network round trip time, which can be different f.e. due to DNS failures. |
|     -W timeout      | 以毫秒为单位设置ping的超时时间；                             |
|     -w deadline     | deadline；                                                   |

```shell
# Basic Usage$ ping host.example.com
ping 10.5.0.5
# Send exact N packets and stop
ping –c 5 google.com
# Change packet size (<size> + 20 + 8 = actual bytes)
ping –s 100 host.example.com
# Flood the network
sudo ping -f host.example.com
```

## 2. traceroute

```sh
选项
-d：使用Socket层级的排错功能；
-f<存活数值>：设置第一个检测数据包的存活数值TTL的大小；
-F：设置勿离断位；
-g<网关>：设置来源路由网关，最多可设置8个；
-i<网络界面>：使用指定的网络界面送出数据包；
-I：使用ICMP回应取代UDP资料信息；
-m<存活数值>：设置检测数据包的最大存活数值TTL的大小；
-n：直接使用IP地址而非主机名称；
-p<通信端口>：设置UDP传输协议的通信端口；
-r：忽略普通的Routing Table，直接将数据包送到远端主机上。
-s<来源地址>：设置本地主机送出数据包的IP地址；
-t<服务类型>：设置检测数据包的TOS数值；
-v：详细显示指令的执行过程；
-w<超时秒数>：设置等待远端主机回报的时间；
-x：开启或关闭数据包的正确性检验。

# Basic Usage
traceroute host.example.com
traceroute 10.5.0.5
traceroute –p 1234 host.example.com
# ICMP
traceroute –-icmp host.example.com
# TCP
traceroute –T –p 443 host.example.com
# IPv6
traceroute -6 host.example.com

traceroute -m 10 www.baidu.com # 跳数设置
traceroute -n www.baidu.com    # 显示IP地址，不查主机名
traceroute -p 6888 www.baidu.com  # 探测包使用的基本UDP端口设置6888
traceroute -q 4 www.baidu.com  # 把探测包的个数设置为值4
traceroute -r www.baidu.com    # 绕过正常的路由表，直接发送到网络相连的主机
traceroute -w 3 www.baidu.com  # 把对外发探测包的等待响应时间设置为3秒
```

## 3. telnet

```sh
选项

-8：允许使用8位字符资料，包括输入与输出；
-a：尝试自动登入远端系统；
-b<主机别名>：使用别名指定远端主机名称；
-c：不读取用户专属目录里的.telnetrc文件；
-d：启动排错模式；
-e<脱离字符>：设置脱离字符；
-E：滤除脱离字符；
-f：此参数的效果和指定"-F"参数相同；
-F：使用Kerberos V5认证时，加上此参数可把本地主机的认证数据上传到远端主机；
-k<域名>：使用Kerberos认证时，加上此参数让远端主机采用指定的领域名，而非该主机的域名；
-K：不自动登入远端主机；
-l<用户名称>：指定要登入远端主机的用户名称；
-L：允许输出8位字符资料；
-n<记录文件>：指定文件记录相关信息；
-r：使用类似rlogin指令的用户界面；
-S<服务类型>：设置telnet连线所需的ip TOS信息；
-x：假设主机有支持数据加密的功能，就使用它；
-X<认证形态>：关闭指定的认证形态。

# Basic Usage
telnet <ip_address> <port>
```

## 4. curl

```sh
# Basic Usage
$ curl <url>
# Echo IP
$ curl ifconfig.me
# Cheat sheet (cheat.sh)
$ curl cheat.sh/curl
# Use telnet to check L4 connectivity
$ curl –vv telnet://host.example.com:1234
# Post JSON
$ curl -X POST 127.0.0.1:1234 ¥
	-H 'Content-Type:application/json’ ¥
	--data '{"key":"value"}'
```



## 5. netcat（nc）

## 6. tcpdump

## 7. nmap

## 8. dig

## 9. netstat

## 10. ss

## 11. ip

## 12. arp

## 13. whois

## 14. lsof

## 15. dhclient